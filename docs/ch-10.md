# CH10. 다양한 도커 활용 방법

- 팀 개발에서 개발환경을 통일
- 명령행 도구를 통한 도커 컨테이너 사용법
- 도커를 이용한 부하 테스트 방법

## 1. 팀 개발에서 개발 환경 통일하기

- INTRO
    - 어플리케이션 및 미들웨어의 동작을 환경 변수로 제어하는 방법으로 도커 이미지의 추상 수준을 높일 수 있다.
    - 다양한 환경에 배포하기 쉽게 할 수 있다.
    - 개발 환경을 공유하고 통일하는 방법으로 이용할 수 있다.
- 소프트웨어 및 도구 통일
    - 호스에서 격리된 환경에 필요한 도구를 갖춘 도커 컨테이너를 공통 개발 환경으로 사용하는 것이 바람직하다.
    - 예시
        - MySQL이나 Redis 같은 데이터스토어를 사용한는 프로젝트는 이 외 데이터스토어를 조작하기 위한 클라이언트 도구가 필요하다.
        - 고성능 MySQL 클라이언트인 mycli 혹은 Redis 클라이언트인 redis-tools를 팀의 표준 도구로 지정하면 다음과 같은 도커 이미지를 공통 개발 환경으로 사용할 수 있다.
        - Dockerfile
            ```Dockerfile
            FROM ubuntu:16.04

            RUN apt -y update
            RUN apt -y install net-tools \
            iproute2 \
            inetutils-ping \
            tcpdump \
            mycli \
            redis-tools
            ```
        - 이미지 빌드 및 컨테이너 생성(docker)
            ```
            $ docker image build -t ch10/workspace:latest .
            $ docker container run --rm -it --name workspace ch10/workspace:latest bash
            ```
        - 쿠버네티스에서 workspace 생성
            ```
            $ kubectl run -i --rm --tty workspace --image=ch10/workspace:latest --restart=Never -- bash -il
            ```
    - '하나의 컨테이너에 하나의 관심사'라는 도커의 원칙에는 어긋나지만, 어플리케이션 배포 용도가 아니므로 괜찮다.
- 개발 환경은 집단지성의 결과
    - 팀 내 표준 개발 환경을 도커 컨테이너 형태로 제공하는 것은 매우 의미 있는 일이다.
    - 장점
        - 일단 개발 환경을 공유하면 여러 개발자가 수고를 덜 수 있다.
        - 각자가 가진 노하우를 공유하고 이렇게 형성한 집단지성을 업무에 활용이 가능하다.
        - 환경 구성 절차를 Dockerfile 형태의 프로그램으로 작성할 수 있다.
        - 신속하게 컨테이너를 실행하고 폐기할 수 있기 때문에 개발 환경에 베스트 프랙티스를 지속해서 반영할 수 있다.

## 2. 도커 컨테이너에서 명령행 도구(CLI) 사용하기

- Dockerfile의 문법 검사를 도와주는 명령행 도구인 hadolint를 도커 컨테이너 형태로 실행한다.
    - Dockerfile
        ```
        FROM alpine

        RUN echo "docker!!"
        ```
    - 검사
        ```
        $ docker container run --rm -i hadolint/hadolint < Dockerfile
        /dev/stdin:1 DL3006 Always tag the version of an image explicitly
        ```
    - 이미지 버전 생략의 경고인 DL3006이 발생했다.
    - hadolint와 같은 도구를 처음 사용하더라도 추가적인 수고는 들지 않는다.
    - -i 옵션 : Dockerfile을 리다이렉트로 전달하기 위해서 사용하였다.
    - -v 옵션이 자주 같이 사용된다.
    - 명령행 도구도 호스트에 설치하지 않고 도커 컨테이너 형태로 사용할 수 있다.
- 이미지에서 명령행 도구 버전 변경하기
    - 명령행 도구를 사용할 때 중요함 점이 도구의 버전을 관리하는 것이다.
    - 명령행 도구를 편리하게 사용하려면도구 버전을 업데이트하거나 특정 버전으로 고정하는 작업이 꼭 필요하다.
    - 명령행 도구를 사용하면서 다음과 같은 필요가 발생할 수 있다.
        - 항상 최신 버전(보안 패치가 모두 적용된)을 사용할 수 있다.
        - 버전이 바뀔 때마다 변경 사항이 많은 도구라서 특정 버전을 고정적으로 사용하고 싶다.
    - 명령해 도구의 도커 이미지를 버전 별로 만들어 두는 것이 좋다.
        - 언제든지 필요한 버전의 명령행 도구를 사용할 수 있다.
    - 예제 jq를 도커 컨테이너로 실행
        - Dockerfile


## 3. 부하 테스트

- 